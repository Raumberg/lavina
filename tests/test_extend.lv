extend vector:
    auto fn double_all():
        return __lv_col_map(this, (auto x) => x * 2)

    int fn sum():
        int result = 0
        for x in this:
            result += x
        return result

    auto fn square():
        return __lv_col_map(this, (auto x) => x * x)

extend string:
    string fn shout():
        return this + "!"

void fn main():
    vector[int] nums = [1, 2, 3, 4, 5]

    // Test extend vector: double_all
    auto d = nums.double_all()
    lv_assert(d[0] == 2, "double_all [0]")
    lv_assert(d[4] == 10, "double_all [4]")

    // Test extend vector: sum
    lv_assert(nums.sum() == 15, "sum")

    // Test extend vector: square
    auto sq = nums.square()
    lv_assert(sq[0] == 1, "square [0]")
    lv_assert(sq[2] == 9, "square [2]")

    // Test extend string: shout
    string greeting = "hello"
    lv_assert(greeting.shout() == "hello!", "shout")

    // Test extend chaining: double_all then sum
    int chain_sum = nums.double_all().sum()
    lv_assert(chain_sum == 30, "chain double_all().sum()")

    // Test extend chaining: square then double_all
    auto chain_sq_dbl = nums.square().double_all()
    lv_assert(chain_sq_dbl[0] == 2, "chain square().double_all() [0]")
    lv_assert(chain_sq_dbl[2] == 18, "chain square().double_all() [2]")

    // Test extend chaining: three levels
    int triple_chain = nums.double_all().square().sum()
    lv_assert(triple_chain == 220, "chain 3 levels: 2+4+6+8+10 squared = 4+16+36+64+100")
