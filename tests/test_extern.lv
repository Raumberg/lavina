// Test: extern blocks for FFI

// 1. Basic system header (no import, no link)
extern "cmath":
    float fn sqrt(float x) = "std::sqrt"
    float fn fabs(float x) = "std::fabs"

// 2. Duplicate extern with same header (tests include deduplication)
extern "cmath":
    float fn ceil_fn(float x) = "std::ceil"

// 3. Extern with import only (header-only lib from a path)
//    Note: import path not exercised via make test (g++ -I/tmp), but parsed correctly
extern "cmath" import "/usr/include":
    float fn floor_fn(float x) = "std::floor"

// 4. Extern with link only
extern "cmath" link "m":
    float fn log_fn(float x) = "std::log"

// 5. Extern with both import and link (import first)
extern "cmath" import "/usr/include" link "m":
    float fn sin_fn(float x) = "std::sin"

// 6. Extern with both import and link (link first â€” reversed order)
extern "cmath" link "m" import "/usr/include":
    float fn cos_fn(float x) = "std::cos"

void fn main():
    // Test 1: basic extern
    float val = 16.0
    float result = sqrt(val)
    lv_assert(result > 3.99 and result < 4.01, "sqrt(16) should be ~4.0")

    float neg = fabs(-42.5)
    lv_assert(neg > 42.49 and neg < 42.51, "fabs(-42.5) should be ~42.5")

    // Test 2: duplicate extern block
    float c = ceil_fn(2.3)
    lv_assert(c > 2.99 and c < 3.01, "ceil(2.3) should be ~3.0")

    // Test 3: extern with import
    float f = floor_fn(2.7)
    lv_assert(f > 1.99 and f < 2.01, "floor(2.7) should be ~2.0")

    // Test 4: extern with link
    float l = log_fn(1.0)
    lv_assert(l > -0.01 and l < 0.01, "log(1.0) should be ~0.0")

    // Test 5: extern with import + link
    float s = sin_fn(0.0)
    lv_assert(s > -0.01 and s < 0.01, "sin(0.0) should be ~0.0")

    // Test 6: extern with link + import (reversed order)
    float co = cos_fn(0.0)
    lv_assert(co > 0.99 and co < 1.01, "cos(0.0) should be ~1.0")
