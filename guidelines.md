## Архитектурная дорожная карта

### Фаза 1: Tree-walking интерпретатор (MVP)
**Цель**: работающий язык с базовыми фичами
```
Компоненты:
  ├── Лексер (токенизация)
  ├── Парсер (AST построение)
  ├── Type Checker (статическая проверка)
  ├── Directive Processor (обработка директив)
  └── Tree-walking интерпретатор

Фичи Фазы 1:
  ✓ Базовые типы (int, bool, string)
  ✓ Арифметические операции
  ✓ Переменные (let)
  ✓ Условия (if/else)
  ✓ Циклы (while)
  ✓ Функции без замыканий
  ✓ Базовые директивы
  ✓ REPL с проверкой типов
```

### Фаза 2: Bytecode + Виртуальная машина
**Цель**: 10-100x ускорение выполнения
```
Компоненты:
  ├── Компилятор AST → Bytecode
  ├── Виртуальная машина
  ├── Система типов в рантайме
  └── Базовый GC

Новые фичи:
  ✓ Замыкания
  ✓ Модули и импорт
  ✓ Структуры/классы
  ✓ Исключения
  ✓ Расширенные директивы оптимизации
  ✓ Профилировщик
```

### Фаза 3: JIT/AOT компиляция
**Цель**: нативная производительность
```
Компоненты:
  ├── JIT-компилятор байткода → машинный код
  ├── Оптимизатор на основе профиля
  ├── AOT-компилятор для standalone программ
  └── Взаимодействие с FFI

Фиши Фазы 3:
  ✓ Параллелизм (async/await)
  ✓ Generic-типы
  ✓ Макросы
  ✓ Плагинная архитектура
  ✓ Поддержка IDE (LSP)
```

## Приблизительная структура проекта (Rust)
```
lavina/
├── Cargo.toml
├── src/
│   ├── lib.rs
│   ├── main.rs          # CLI интерфейс
│   ├── repl.rs          # Интерактивная среда
│   ├── lexer/           # Лексический анализ
│   │   ├── mod.rs
│   │   ├── token.rs     # Токены
│   │   └── scanner.rs   # Сканер
│   ├── parser/          # Синтаксический анализ
│   │   ├── mod.rs
│   │   ├── ast.rs       # AST структуры
│   │   └── grammar.rs   # Правила парсинга
│   ├── type/            # Система типов
│   │   ├── mod.rs
│   │   ├── checker.rs   # Проверка типов
│   │   └── inference.rs # Вывод типов
│   ├── directive/       # Обработка директив
│   │   ├── mod.rs
│   │   ├── processor.rs
│   │   └── registry.rs  # Реестр директив
│   ├── eval/            # Интерпретатор
│   │   ├── mod.rs
│   │   ├── tree_walker.rs # Фаза 1
│   │   └── environment.rs # Окружение
│   ├── bytecode/        # Фаза 2
│   │   ├── mod.rs
│   │   ├── compiler.rs  # AST → Bytecode
│   │   ├── vm.rs        # Виртуальная машина
│   │   └── opcodes.rs   # Инструкции
│   └── jit/             # Фаза 3
│       ├── mod.rs
│       ├── compiler.rs  # JIT компилятор
│       └── runtime.rs   # Нативный рантайм
├── examples/            # Примеры программ
├── tests/               # Тесты
└── docs/                # Документация
```